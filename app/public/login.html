<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Move Around TMS | Fleet Login</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(180deg, #001b34 0%, #003b8e 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: #fff;
        margin: 0;
      }
      .box {
        background: #fff;
        color: #000;
        padding: 40px;
        border-radius: 12px;
        width: 360px;
        text-align: center;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.3);
      }
      h1 {
        margin-bottom: 6px;
        color: #003b8e;
        font-size: 22px;
      }
      p.subtitle {
        margin: 0 0 20px 0;
        font-size: 14px;
        color: #444;
      }
      input {
        width: 90%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
      }
      button {
        width: 95%;
        padding: 10px;
        margin-top: 8px;
        background: #004aad;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }
      button:hover {
        background: #003b8e;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      #msg {
        margin-top: 10px;
        padding: 8px;
        border-radius: 4px;
        display: none;
      }
      #msg.error {
        color: #d32f2f;
        background: #ffebee;
        border: 1px solid #ffcdd2;
      }
      #msg.success {
        color: #2e7d32;
        background: #e8f5e8;
        border: 1px solid #c8e6c9;
      }
      footer {
        margin-top: 20px;
        font-size: 12px;
        color: #666;
      }
      .redirect-notice {
        margin-top: 10px;
        padding: 8px;
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        color: #1565c0;
        border-radius: 4px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <h1>Move Around TMS</h1>
      <p class="subtitle">Fleet Management Login</p>

      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Password" />
      <button id="loginBtn">Sign In</button>
      <div id="msg"></div>

      <div class="redirect-notice">
        For the full TMS application, visit:
        <a href="/login" style="color: #1565c0">app.movearoundtms.com/login</a>
      </div>

      <footer>Powered by Move Around TMS</footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // ⚠️ SECURITY: Environment variables should be used instead of hard-coded values
      // This is a demo - in production, use server-side environment variables

      // Check if running in development with environment variables available
      const SUPABASE_URL = window.ENV?.SUPABASE_URL || "CONFIGURATION_REQUIRED";
      const SUPABASE_KEY =
        window.ENV?.SUPABASE_ANON_KEY || "CONFIGURATION_REQUIRED";

      if (
        SUPABASE_URL === "CONFIGURATION_REQUIRED" ||
        SUPABASE_KEY === "CONFIGURATION_REQUIRED"
      ) {
        document.getElementById("msg").innerHTML =
          "⚠️ Configuration required. Please set up environment variables.<br>" +
          "<small>See SECURITY-REMEDIATION.md for setup instructions.</small>";
        document.getElementById("msg").className = "error";
        document.getElementById("msg").style.display = "block";
        document.getElementById("loginBtn").disabled = true;
      } else {
        // Initialize Supabase client
        const supabase = window.supabase.createClient(
          SUPABASE_URL,
          SUPABASE_KEY,
        );

        document
          .getElementById("loginBtn")
          .addEventListener("click", async () => {
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value;
            const msg = document.getElementById("msg");
            const btn = document.getElementById("loginBtn");

            // Reset message
            msg.style.display = "none";
            msg.className = "";

            if (!email || !password) {
              msg.textContent = "Please enter both email and password";
              msg.className = "error";
              msg.style.display = "block";
              return;
            }

            // Show loading state
            btn.textContent = "Signing In...";
            btn.disabled = true;

            try {
              const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password,
              });

              if (error) {
                msg.textContent = error.message;
                msg.className = "error";
                msg.style.display = "block";
              } else {
                msg.textContent = "Login successful! Redirecting...";
                msg.className = "success";
                msg.style.display = "block";

                // Redirect to dashboard after short delay
                setTimeout(() => {
                  window.location.href = "/dashboard";
                }, 1000);
              }
            } catch (err) {
              msg.textContent = "Connection error. Please try again.";
              msg.className = "error";
              msg.style.display = "block";
            } finally {
              // Reset button state
              btn.textContent = "Sign In";
              btn.disabled = false;
            }
          });

        // Allow Enter key to submit
        document.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            document.getElementById("loginBtn").click();
          }
        });
      }
    </script>
  </body>
</html>
